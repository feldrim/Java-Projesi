import java.util.Iterator;
import java.util.Scanner;
import java.util.Vector;

public class EmirListesi {
	/*
	 * emirAra() main'e eklenecek emirTekrarla() yeniden yazýlacak KomutanA ve
	 * KomutanB kýsýtlarý emirEkle()'ye eklenecek
	 */

	Vector<Emir> emirListesi = new Vector<Emir>();
	Vector<Integer> aTipiKomutanEmirleri = new Vector<Integer>(); //günsonu alýnýrken boþaltýlacak
	public static final int LIMIT = 100;

	private Scanner sc = new Scanner(System.in);
	private Komutan emirVeren;
	private Emir temp;
	private int emirTuru;


	public EmirListesi() {
	}

	public void emirEkle(Tarih bugun, KomutanListesi komutanListesi) {
		int apolet;
		
		if (emirListesi.size() == LIMIT) {
			System.out.println("Daha fazla emir ekleyemezsiniz.");
			return;
		}

		do {
			System.out.println("Emri Veren Komutanýn Apolet Numarasý: ");
			apolet = sc.nextInt();
			if (apolet == 0) {
				return;
			} else if (!komutanListesi.komutanMevcutMu(apolet)) {
				System.out.println("Komutan Bulunamadý.");
			}
		} while (!komutanListesi.komutanMevcutMu(apolet));

		emirVeren = komutanListesi.komutanAl(apolet);
		
		System.out.println("Emri veren: " + emirVeren.kimlikAl() + "\n");
		
		if(emirVeren.komutanTuruAl().equals("KomutanA")){
			
			int bireyselSayac = 0;//Test verilerini saymadýðýndan sorun oluyor. Dinamik yapmak lazým.
			aTipiKomutanEmirleri.add(emirVeren.apoletNumarasýAl());
			
			for(int i = 0; i < aTipiKomutanEmirleri.size(); i++){
				if(aTipiKomutanEmirleri.contains(emirVeren.apoletNumarasýAl())){
					bireyselSayac++;
				}
			}
			
			if(bireyselSayac == 3){
				System.out.println("A Tipi bir komutan ayný gün içinde 2'den fazla emir veremez.");
				aTipiKomutanEmirleri.remove(aTipiKomutanEmirleri.size() - 1);
				return;
			}
			
			if(aTipiKomutanEmirleri.size() == 6){
				System.out.println("A Tipi komutanlar ayný gün içinde toplamda 5'ten fazla emir veremezler.");
				aTipiKomutanEmirleri.remove(aTipiKomutanEmirleri.size() - 1);
				return;
			}
		
			System.out.println("Bugün " + emirVeren.kimlikAl() + " tarafýndan verilen " + bireyselSayac + ". emir.");
		}

		System.out.println("Emir No: " + (emirListesi.size() + 1));

		System.out.println("1. Temizlik Emri\n2. Spor Emri");
		int secim = sc.nextInt();
		
		if(emirVeren.komutanTuruAl().equals("KomutanB")) {			
			for(int i = emirListesi.size() - 1 ; i >= 0 ; i--){
				if(emirListesi.get(i).emirVerenKomutanAl().apoletNumarasýAl() == apolet){
					if((emirListesi.get(i).getClass().getName() == "TemizlikEmri" && secim == 1) ||
					   (emirListesi.get(i).getClass().getName() == "SporEmri" && secim == 2)){
						
						System.out.println("Bir önceki emrinizden farklý bir türde bir emir vermelisiniz.");
						System.out.println("Bir önceki emriniz:\n" + emirListesi.get(i).emirOzeti());
						return;
					}
				}
			}
		}

		boolean gecerliSecim = false;
		do {
			switch (secim) {

			case 1:

				System.out.println("Temizlik yapýlacak bölge: ");
				String bolgeAdi = sc.next();
				System.out.println("Temizlik türü: (1. Mýntýka, 2. Kýþ, 3. Peyzaj)");
				int temizlikTuru = sc.nextInt();
				System.out.println("Temizlik yapacak kiþi sayýsý:");
				int kisiSayisi = sc.nextInt();
				temp = new TemizlikEmri((emirListesi.size() + 1), bugun, null, emirVeren, false, bolgeAdi, temizlikTuru,
						kisiSayisi);
				gecerliSecim = true;
				break;

			case 2:
				System.out.println("Açýklama: ");
				String hareketTuru = sc.next();
				System.out.println("Tekrar sayýsý: ");
				int tekrarSayisi = sc.nextInt();
				temp = new SporEmri((emirListesi.size() + 1), bugun, null, emirVeren, false, hareketTuru, tekrarSayisi);
				gecerliSecim = true;
				break;

			default:
				System.out.println("Geçerli bir giriþ yapýnýz.");
				gecerliSecim = false;
			}
		} while (!gecerliSecim);
		
		emirTuru = secim;

		Tarih uygulamaTarihi = new Tarih();

		do {
			System.out.println("Emir Uygulama Tarihi:       (Bugün: " + bugun.tarihAl() + ")");
			uygulamaTarihi = uygulamaTarihi.tarihAyarla();

			if (bugun.gecerliTarih(uygulamaTarihi) == false) {
				System.out.println("Geçerli bir tarih giriniz.");
			}
		} while (bugun.gecerliTarih(uygulamaTarihi) == false);
		
		temp.uygulamaTarihiBelirle(uygulamaTarihi);

		gecerliSecim = false;

		do {
			System.out.println("\n\nEmri tekrarlamak istiyor musunuz?" + "\n0.  Hayýr" + "\n1. Günlük" + "\n2. Haftalýk"
					+ "\n3. Aylýk");

			secim = sc.nextInt();
			int tekrar;

			switch (secim) {
			case 0:
				emirTekrarla(1, 0);
				gecerliSecim = true;
				break;
			case 1:
				System.out.println("Tekrar sayýsý:");
				tekrar = sc.nextInt();
				emirTekrarla(tekrar, 1);
				gecerliSecim = true;
				break;
			case 2:
				System.out.println("Tekrar sayýsý:");
				tekrar = sc.nextInt();
				emirTekrarla(tekrar, 7);
				gecerliSecim = true;
				break;
			case 3:
				System.out.println("Tekrar sayýsý:");
				tekrar = sc.nextInt();
				emirTekrarla(tekrar, 30);
				gecerliSecim = true;
				break;
			default:
				System.out.println("Geçerli bir giriþ yapýnýz.");
				gecerliSecim = false;

			}

		} while (!gecerliSecim);

	}

	public void emirListesiYazdir() {
		if (emirListesi.isEmpty()) {
			System.out.println("Emir listesi boþ");
		} else {
			System.out.println("Kayýtlý emirler: (" + emirListesi.size() + "/" + LIMIT + ")");
			
			
			Iterator<Emir> it = emirListesi.iterator();
			while (it.hasNext())
				System.out.println("* " + it.next().emirOzeti());
			}
	}

	public void emirAra(int emirNo) {
		if (emirNo > emirListesi.size()) {
			System.out.println("Emir bulunamadý.");
		} else {
			System.out.println("Emir bulundu:\n" + emirListesi.get(emirNo - 1).emirMetni());
		}
	}

	public void emirSil() {
		System.out.println("Silinecek emir numarasýný yazýn: ");
		int emirNo = sc.nextInt();

		if (emirNo > emirListesi.size() || emirNo < 1) {
			System.out.println("Emir bulunamadý.");
		} else {
			emirListesi.remove(emirListesi.get(emirNo - 1));
			System.out.println("Emir silindi.");
		}
	}

	public void emirTekrarla(int tekrar, int periyot) {
		if(tekrar > 5){
			System.out.println("En fazla 5 kez tekrar edebilirsiniz. Emriniz 5 tekrar olarak alýnmýþtýr.");
			tekrar = 5;
		}
		emirListesi.add(temp);
		
		for(int i = 1 ; i < tekrar; i++){
			
			if(emirTuru == 1){
				emirListesi.add(new TemizlikEmri());
				((TemizlikEmri)emirListesi.lastElement()).emirNoBelirle(emirListesi.get(emirListesi.size() - 2).emirNoAl() + 1);
				((TemizlikEmri)emirListesi.lastElement()).verilmeTarihiBelirle(emirListesi.get(emirListesi.size() - 2).verilmeTarihiAl());
				((TemizlikEmri)emirListesi.lastElement()).uygulamaTarihiBelirle(emirListesi.get(emirListesi.size() - 2).uygulamaTarihiAl().gunSonra(periyot));
				((TemizlikEmri)emirListesi.lastElement()).emirVerenKomutanBelirle(emirListesi.get(emirListesi.size() - 2).emirVerenKomutanAl());
				((TemizlikEmri)emirListesi.lastElement()).uygulamaDurumuBelirle(emirListesi.get(emirListesi.size() - 2).uygulamaDurumuAl());
				((TemizlikEmri)emirListesi.lastElement()).bolgeAdiBelirle( ( (TemizlikEmri)emirListesi.get(emirListesi.size() - 2)).bolgeAdiAl());
				((TemizlikEmri)emirListesi.lastElement()).temizlikTuruBelirle( ( (TemizlikEmri)emirListesi.get(emirListesi.size() - 2)).temizlikTuruAl());
				((TemizlikEmri)emirListesi.lastElement()).kisiSayisiBelirle( ( (TemizlikEmri)emirListesi.get(emirListesi.size() - 2)).kisiSayisiAl());
				
			} else {
				emirListesi.add(new SporEmri());
				((SporEmri)emirListesi.lastElement()).emirNoBelirle(emirListesi.get(emirListesi.size() - 2).emirNoAl() + 1);
				((SporEmri)emirListesi.lastElement()).verilmeTarihiBelirle(emirListesi.get(emirListesi.size() - 2).verilmeTarihiAl());
				((SporEmri)emirListesi.lastElement()).uygulamaTarihiBelirle(emirListesi.get(emirListesi.size() - 2).uygulamaTarihiAl().gunSonra(periyot));
				((SporEmri)emirListesi.lastElement()).emirVerenKomutanBelirle(emirListesi.get(emirListesi.size() - 2).emirVerenKomutanAl());
				((SporEmri)emirListesi.lastElement()).uygulamaDurumuBelirle(emirListesi.get(emirListesi.size() - 2).uygulamaDurumuAl());
				((SporEmri)emirListesi.lastElement()).hareketTuruBelirle( ( (SporEmri)emirListesi.get(emirListesi.size() - 2)).hareketTuruAl());
				((SporEmri)emirListesi.lastElement()).tekrarSayisiBelirle( ( (SporEmri)emirListesi.get(emirListesi.size() - 2)).tekrarSayisiAl());
			}
			
		}

		switch(periyot){
		case 0:
			System.out.println(emirListesi.lastElement().emirOzeti() + " oluþturuldu");
			break;
		case 1:
			System.out.println(emirListesi.lastElement().emirOzeti() + ",\n günlük olarak " + tekrar + " tekrar olacak þekilde oluþturuldu.");
			break;
		case 7:
			System.out.println(emirListesi.lastElement().emirOzeti() + ",\nhaftada bir kez " + tekrar + " tekrar olacak þekilde oluþturuldu.");
			break;
		case 30:
			System.out.println(emirListesi.lastElement().emirOzeti() + ",\nayda bir kez " + tekrar + " tekrar olacak þekilde oluþturuldu.");
			break;
		}
	}

	public void gunSonu(Tarih bugun) {
		
		aTipiKomutanEmirleri.clear();
		int bugunVerilenEmirSayisi = 0;
		int bugunTamamlananEmirSayisi = 0;
		System.out.println("Gün sonu alýnýyor.");

		if (emirListesi.size() == 0) {
			System.out.println("Uygulanacak emir yok.");
		} else {
			for (int i = 0; i < emirListesi.size(); i++) {
				if (emirListesi.get(i).verilmeTarihiAl() == bugun) {
					bugunVerilenEmirSayisi++;
				}

				if (emirListesi.get(i).uygulamaTarihiAl() == bugun) {
					emirListesi.get(i).emriUygula();
					bugunTamamlananEmirSayisi++;
				}
			}

		}
		
		System.out.println("\n" + bugun.tarihAl() + " tarihinde " + bugunVerilenEmirSayisi + " emir verilmiþ, "
				+ bugunTamamlananEmirSayisi + " emir tamamlanmýþtýr.");
	}

	public void testVerisiUret(Tarih bugun, KomutanListesi komutanListesi) {
		komutanListesi.testVerisiUret();

		Emir[] testListesi = new Emir[4];
		testListesi[0] = new TemizlikEmri(1, bugun, bugun, komutanListesi.komutanAl(3001), false, "bahçe", 1, 5);
		testListesi[1] = new SporEmri(2, bugun, bugun, komutanListesi.komutanAl(3002), false, "Mekik", 50);
		testListesi[2] = new TemizlikEmri(3, bugun, bugun.gunSonra(1), komutanListesi.komutanAl(3004), false, "avlu", 1,
				7);
		testListesi[3] = new SporEmri(4, bugun, bugun.gunSonra(1), komutanListesi.komutanAl(3005), false, "Þýnav", 50);

		for (int i = 0; i < testListesi.length; i++) {
			emirListesi.add(testListesi[i]);
			if(testListesi[i].emirVerenKomutanAl().getClass().getName() == "KomutanA"){
				aTipiKomutanEmirleri.add(testListesi[i].emirVerenKomutanAl().apoletNumarasýAl());
			}
		}
		
		
		
		
		System.out.println("Test verisi üretildi.");

	}
}
